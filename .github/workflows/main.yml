name: 🃏 Autocommit workflow

on:
  schedule:
    - cron: '0 22 * * *' # Chạy hàng ngày vào 22:00 UTC

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
    - name: 🔍 Check out code
      uses: actions/checkout@v2

    - name: ⚡️ Update README
      run: |
        if [ ! -f "README.md" ]; then
          echo "| Emoji        | Count |" > README.md
          echo "|--------------|-------|" >> README.md
          echo "| :smile: | 1 |" >> README.md
        else
          EMOJIS=(":smile:" ":laughing:" ":blush:" ":smiley:")
          RANDOM_EMOJI=${EMOJIS[$RANDOM % ${#EMOJIS[@]}]}
          if grep -q "$RANDOM_EMOJI" README.md; then
            sed -i "s/| $RANDOM_EMOJI | [0-9]* |/| $RANDOM_EMOJI | $(( $(grep -oP '\| \K[0-9]+(?= \|)' <<< $(grep $RANDOM_EMOJI README.md)) + 1 )) |/" README.md
          else
            echo "| $RANDOM_EMOJI | 1 |" >> README.md
          fi
        fi

        echo "Updated README.md:"
        cat README.md

    - name: ✅ Commit and push
      run: |
        if [[ "$(date +%Y)" -gt "2026" ]]; then
          echo "It's now past 2026, stopping updates."
          exit 0
        fi

        git config --local user.email "hotaruu24k@gmail.com"
        git config --local user.name "kleqing"
        git add README.md

        if ! git diff --cached --quiet; then
          git commit -m "🆕 New Emoji Added $RANDOM_EMOJI"
          git push
        else
          echo "No changes to commit."
        fi
      env:
        GITHUB_TOKEN: ${{ secrets.TOKEN }}
