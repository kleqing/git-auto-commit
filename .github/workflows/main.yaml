name: ğŸƒ Autocommit workflow

on:
  schedule:
    - cron: '0 */2 * * *' # Run everyday 1 hours
  push:
    branches: [ main ]
  workflow_dispatch:
  
jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ” Check out code
      uses: actions/checkout@v2

    - name: âš¡ï¸ Update README
      run: |
        # If readme.md not exist, create a new one
        if [ ! -f "README.md" ]; then
          echo "| Emoji | Code | Count |" > README.md
          echo "| --- | --- | --- |" >> README.md
          echo "| ğŸ˜„ | :smile: | 1 |" >> README.md
        else
          # Emojis
          EMOJIS=(
            "ğŸ˜„ :smile:"
            "ğŸ˜† :laughing:"
            "ğŸ˜Š :blush:"
            "ğŸ˜€ :smiley:"
            "â˜ºï¸ :relaxed:"
            "ğŸ˜ :smirk:"
            "ğŸ˜ :heart_eyes:"
            "ğŸ˜˜ :kissing_heart:"
            "ğŸ˜š :kissing_closed_eyes:"
            "ğŸ˜³ :flushed:"
            "ğŸ˜Œ :relieved:"
            "ğŸ˜† :satisfied:"
            "ğŸ˜ :grin:"
            "ğŸ˜‰ :wink:"
            "ğŸ˜œ :stuck_out_tongue_winking_eye:"
            "ğŸ˜ :stuck_out_tongue_closed_eyes:"
            "ğŸ˜€ :grinning:"
            "ğŸ˜— :kissing:"
            "ğŸ˜™ :kissing_smiling_eyes:"
            "ğŸ˜› :stuck_out_tongue:"
          )
          
          # Choose random emojis
          RANDOM_ENTRY=${EMOJIS[$RANDOM % ${#EMOJIS[@]}]}
          RANDOM_EMOJI=$(echo $RANDOM_ENTRY | cut -d' ' -f1)
          RANDOM_CODE=$(echo $RANDOM_ENTRY | cut -d' ' -f2)
    
          # Check if emoji exist in readme.md
          if grep -q "$RANDOM_CODE" README.md; then
            # increase count
            sed -i "s/| $RANDOM_EMOJI | $RANDOM_CODE | [0-9]* |/| $RANDOM_EMOJI | $RANDOM_CODE | $(( $(grep -oP '(?<=\| '$RANDOM_CODE' \| )\d+' README.md) + 1 )) |/" README.md
          else
            # Add new one if not exist
            echo "| $RANDOM_EMOJI | $RANDOM_CODE | 1 |" >> README.md
          fi
        fi
    
        # Update
        echo "Updated README.md:"
        cat README.md
    

    - name: âœ… Commit and push
      run: |
        if [[ "$(date +%Y)" -gt "2026" ]]; then
          echo "It's now past 2026, stopping updates."
          exit 0
        fi

        git config --local user.email "hotaruu24k@gmail.com"
        git config --local user.name "kleqing"
        git add README.md

        if ! git diff --cached --quiet; then
          git commit -m "ğŸ†• New Emoji Added $RANDOM_EMOJI"
          git push
        else
          echo "No changes to commit."
        fi
      env:
        GITHUB_TOKEN: ${{ secrets.TOKEN }}
